<!DOCTYPE html>
<html>
<head>
<title>觅家美国</title>
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="//fonts.googleapis.com/css?family=Roboto:300,100,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<script type="text/javascript" src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0"></script>
<%= stylesheet_link File.join(ASSET_URL, '/wechat/agent.css') %>
<%= javascript_tag File.join(ASSET_URL, '/js/bundle_vendor.js') %>
<script>
var SERVER_URL = "<%= MEEHOME_SERVER_URL %>";
var CLIENT_URL = "<%= MEEHOME_CLIENT_URL %>";
var CDN_URL = "<%= CDN_URL %>"
var agentId = "<%= @agent_info[:agent_id] %>";
var articleId = "<%= @article_id %>";

if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)) {
console.log('mobile');
}
</script>
</head>
<body>
<script type="text/javascript">
$(window).load(function() {
// Animate loader off screen
$(".se-pre-con").fadeOut("slow");
  $('.wechat-icon').on("click",function(){
     $('.qr-warp').fadeIn(900);
  })
});

$(document).ready(function() {
  function showQR() {
    $('#qr-anchor').toggle();
  };

  $.ajax({
    url: '/agent/' + agentId + '/meejia_image',
    type: 'get',

    success: function(data) {
      data = JSON.parse(data);
      var qrImage;
      if(data.is_followed){
        qrImage = data.img_url
      } else {
        qrImage = data.meejia_url
      }
       $('#meejiaImageHref').attr("href", qrImage);
       $('#meejiaImage').attr('src', qrImage);
    },

    error: function() {
      console.log('error generate qr code');
    }
  });

  if(articleId != ''){
    $.ajax({
      url: '/article/' + articleId,
      type: 'get',

      success: function(data) {
        data = JSON.parse(data);
        $('#article').html(data.content);
      },

      error: function() {
        console.log('error fetching article');
      }
    });
  }
})

</script>
<div class="se-pre-con">
  <div class="loading-text">稍安勿躁<br>休息 休息一下</div>
  <div class="preloading"></div>
</div>
<div id="agentcontent">
  <div class="header">
    <div class="logo">
    </div>
  </div>
  <div>
    <div class="agent-page">
      <div class='agent_home_div'>
        <img class='profile_img' src= <%= @agent_info[:head_image]%>/>
        <div class='name_card'>
          <p class="agent-name"><%= @agent_info[:cn_name]%></p>
          <p class="info-mail"><%= @agent_info[:mail]%></p>
          <p class="contact-number">经纪人执照号 <%= @agent_info[:license_id] %></p>
          <p class="description"><%= @agent_info[:description]%></p>
        
          <div class="arrow-container">
            <div class="open-panel">
              长按扫码加我为经纪人
            </div>
            <div class="arrow">
            </div>
            <div id="qr-anchor" class="qr-warp">
              <img class='agent_qr_img' src=<%= @agent_info[:qr_code]%> />
            </div>
          </div>
        </div>
      </div><!--close agent_home_div-->

      

      <div id="article">
      </div>

      <div class='preview_list_div'>
        <h3 class='previewH3'>优质房源</h3>
        <% @home_list.each do |home| %>
          <a class="item-link" href=<%= File.join(MEEHOME_CLIENT_URL, 'home', home['id'].to_s)%> style="background: url(<%= File.join(CDN_URL, 'photo', home['images'].try(:[], 0).try(:[], 'image_url') || 'default.jpg')%>) no-repeat center / cover">
            <div class="estate-item">
              <div class="item-panel left">
                <div class="item-price">
                  <%= home['price'] %>
                </div>
                <div class="item-address">
                  <%= home['addr1'].concat(" #{home['city']}")%>
                </div>
              </div><div class="item-panel right">
                <div class="item-bedroom right-items"> -- <br>Beds</div><div class="item-bathroom right-items"> -- <br>Baths</div><div class="item-squareft right-items"> -- <br>Sq. Ft.</div>
              </div>
            </div>
          </a>
        <% end%>
      </div> <!--close preview_list_div-->
    </div><!--close agent-page-->
    <div class='float_menu'>
      <ul>
        <li><a href=<%= "tel:#{@agent_info[:phone]}" %> ><span class='glyphicon glyphicon-earphone'></span><br/>电话</a></li>
        <li><a href=<%= "sms://#{@agent_info[:phone]}" %>><span class='glyphicon glyphicon-phone'></span><br/>短信</a></li>
        <li><a class="wechat-icon" onclick="showQR()"><span class='glyphicon glyphicon-comment'></span><br/>微信</a></li>
        <li><a href=<%= "mailto:#{@agent_info[:mail]}" %> ><span class='glyphicon glyphicon-envelope'></span><br/>电邮</a></li>
      </ul>
    </div>
  </div>
</div>
</body>
</html>
